# Copyright 2015 Wolf-Dieter Klotz <wdklotz@gmail.com>
# This file is part of the SIMULINAC code

# SIMULINAC is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.

# SIMULINAC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with SIMULINAC.  If not, see <http://www.gnu.org/licenses/>.
#
# Input file for FODO linac simulator
# Input file follows YAML syntax (http:\\http://yaml.org/)
#
# Note:
#   Repeated nodes are initially denoted by an ampersand ( & )
#   and thereafter referenced with an asterisk ( * ).
##...........................................................................................
## run configuration
##...........................................................................................
flags:
    # - accON:        False           # [True]  acceleration on/off flag
    # - egf:          True            # [False] emittance growth flag
    # - map:          False           # [True]  use maps to track trajectories through RFGap
    # - sigma:        False           # [True]  beam sizes by sigma-matrix
    # - KVprint:      True            # [False] print a dictionary of Key-Value pairs, no display
    # - periodic:     True            # [False] treat lattice as periodic cell sequence(else as transfer line)
    # - verbose:      2               # [0]     print flag (0 = minimal print), try 0,1,2,3
##...........................................................................................
## SECTION definitions
##...........................................................................................
sections:
    - [&LE LE,  &HE HE]
##...........................................................................................
## INPUT parameter definitions
##...........................................................................................
parameters:
    - aperture:             0.10       # [m] aperture = bore radius
    - Tkin:                 50.0       # [MeV] energy @ entrance (injection)
    - frequency:    &p01    816.E+6    # [Hz] frequency f0
    - ql0:          &p02    0.10       # [m] quad-length
    - ql:           &p03    0.05       # [m] 1/2 quad-length
    - emity_i:              1.E-6      # [m*rad] transverse emittance @ entrance x
    - emitx_i:              1.E-6      # [m*rad] transverse emittance @ entrance y
    - betax_i:              7.084      # [m] twiss beta @ entrance x (tuned with RF-2x20)
    - betay_i:              1.902      # [m] twiss beta @ entrance y (tuned with RF-2x20)
    - alfax_i:              0.0        # [-] twiss alpha x @ entrance
    - alfay_i:              0.0        # [-] twiss alpha y @ entrance
    - sigmaz_i:              2.5e-5    # [m] longitudinal displacement Dz @ entrance

    # - B_g_LE:   &p04    2.86       # [T/m] quadrupole gradient (opt.kappa)
    # - B_g_LE:   &p04    9.72       # [T/m] quadrupole gradient (max necktie border)
    # - B_g_LE:   &p04    6.87865    # [T/m] quadrupole gradient (~90 deg ph. advance/cell)
    - B_g_LE:     &p04    6.87065    # [T/m] quadrupole gradient (tuned with RF-2x20)

    - Ez_LE:      &p05    1.00       # [MV/m] electric field strength
    - phi_sync:   &p06   -20.        # [deg] synchronous phase
    - gap:        &p07    0.020      # [m] (accelerating) gap size
    - cav_LE:     &p08    0.020      # [m] cavity length
    - windings:             30         # [-] quad-coil windings

    - B_g_HE:     &p11    6.87065    # HE tuned

    - gap_HE:     &p12    0.044      # HE gap
    - cav_HE:     &p13    0.044      # HE cav len
    # - Ez_HE:      &p14    0.28       # [MV/m] electric field strength
    - Ez_HE:      &p14    1.        # [MV/m] electric field strength
    - GAP:        &p15    0.048     # [m] RF gap
#............................................................................................
## ELEMENT definitions
##...........................................................................................
elements:
# LE
    - d1l:    &d1l          # ID
        - type:     D       # D class
        - length:   0.05    # [m]
        - sec:      *LE
    - d2l:    &d2l          # ID
        - type:     D       # D class
        - length:   0.0125  # [m]
        - sec:      *LE
    - qf1l:   &qf1l         # ID
        - type:     QF      # QF class
        - length:   *p03    # [m] 
        - B':       *p04    # [T/m] quadrupole gradient
        - sec:      *LE
    - qd1l:   &qd1l         # ID
        - type:     QD      # QD class
        - length:   *p02    # [m] length
        - B':       *p04    # [T/m] quadrupole gradient
        - sec:      *LE
    - rfgl:  &rfgl          # ID
        - type:     RFG     # class
        # - type:     GAP     # class
        - Ez:       *p05    # [MV/m] electric field
        - PhiSync:  *p06    # [deg] synchronous phase
        - fRF:      *p01    # [Hz] frequency
        - gap:      *p07    # [m] length
        - sec:      *LE

# HE        
    - d1h:        &d1h
        - type:     D       # D class
        - length:   0.08    # [m] 
        - sec:      *HE
    - d2h:    &d2h          # ID
        - type:     D       # D class
        - length:   0.44    # [m] full cavity
        - sec:      *HE
    - dttfg:    &dttfg      # ID
        - type:     D       # D class
        - length:   0.022   # [m] half cavity
        - sec:      *HE
    - qf1h:   &qf1h         # ID
        - type:     QF      # QF class
        - length:   *p03    # [m] 
        - B':       *p11    # [T/m] quadrupole gradient
        - sec:      *HE
    - qd1h:   &qd1h         # ID
        - type:     QD      # QD class
        - length:   *p02    # [m] length
        - B':       *p11    # [T/m] quadrupole gradient
        - sec:      *HE
    - rfgh:  &rfgh          # ID
        - type:     RFG     # class
        # - type:     GAP     # class
        - Ez:       1.00    # [MV/m] electric field
        - PhiSync:  *p06    # [deg] synchronous phase
        - fRF:      *p01    # [Hz] frequency
        - gap:      *p15    # [m] length
        - sec:      *HE
    - rfch:  &rfch          # ID
        - type:     RFC     # RFC class
        - Ez:       *p14    # [MV/m] electric field
        - PhiSync:  *p06    # [deg] synchronous phase
        - fRF:      *p01    # [Hz] frequency
        - gap:      *p12    # [m] length
        - length:   *p13    # [m] length
        - sec:      *HE
    - ttfg:  &ttfg          # ID
        - type:     TTFG    # TTFG class
        - PhiSync:  *p06    # [deg] synchronous phase
        - fRF:      *p01    # [Hz] frequency
        - gap:      *p15    # [m] length
        - SFdata:   SF_WDK2g44.TBL
        - Ezpeak:   1.8055  # [MV/m]
        - sec:      *HE
    - mrk:  &mrk            # ID
        - type:    MRK      # MRK class  
        - actions:
            - sigma_x
            - sigma_y
            - Tkin  
##...........................................................................................
## SEGMENT definitions
##...........................................................................................
segments:
# LE
    - RFG10L:
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
        - *d2l
        - *rfgl
        - *d2l
    - SEG1L:
        - *qf1l
        - *d1l
    - SEG2L:
        - *d1l
        - *qd1l
        - *d1l
    - SEG3L:
        - *d1l
        - *qf1l
# HE
    - SEG1H:
        - *qf1h
        - *d1h
    - SEG2H:
        - *d1h
        - *qd1h
        - *d1h
    - SEG3H:
        - *d1h
        - *qf1h
    - RFCAVH:
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
        - *rfch
    - TTFGH:
        - *dttfg
        - *ttfg
        - *dttfg
        #
        - *dttfg
        - *ttfg
        - *dttfg
        #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
        # - *dttfg
        # - *ttfg
        # - *dttfg
        # #
    - RFGH:
        - *dttfg
        - *rfgh
        - *dttfg
        #
        - *dttfg
        - *rfgh
        - *dttfg
        #
        
    - MARK:
        - *mrk
##...........................................................................................
## LATTICE definition
##...........................................................................................
lattice:
    - title: LE+HE 29.08.2017 15MeV inj          # description is mandatory. DON't remove or reposition!
    # - [1,         SEG1L,    RFG10L,    RFG10L,   SEG2L,    RFG10L,    RFG10L,   SEG3L,    MARK]
    # - [1200,      SEG1H,    TTFGH,               SEG2H,    TTFGH,               SEG3H]
    # - [600,       SEG1H,    RFCAVH,              SEG2H,    RFCAVH,              SEG3H]
    # - [600,       SEG1H,    RFGH,                SEG2H,    RFGH,                SEG3H]
    - [3,       SEG1H,    TTFGH,               SEG2H,    TTFGH,               SEG3H]
    