# Copyright 2015 Wolf-Dieter Klotz <wdklotz@gmail.com>
# This file is part of the SIMULINAC code

# SIMULINAC is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.

# SIMULINAC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with SIMULINAC.  If not, see <http://www.gnu.org/licenses/>.

#..........................................................................................
# Input file for FODO linac simulator
# Input file follows YAML syntax (http:\\http://yaml.org/)
#
# Note:
#   Repeated nodes are initially denoted by an ampersand ( & )
#   and thereafter referenced with an asterisk ( * ).
#..........................................................................................
## RUN switches
FLAGS:
    # - accON:        False           # {True} acceleration on/off flag
    # - egf:          True            # {False} emittance growth flag
    - sigma:        False           # {True} beam sizes by sigma-matrix
    # - KVout:        True            # {False} print a dictionary of Key-Value pairs, no display
    # - periodic:     True            # {False} treat lattice as ring
    # - express:      True            # {False} use express version of thin quads
    - useaper:      True            # {False} use aperture check for lattice elements
    # - csTrak:       False           # {True} plot CS trajectories
    # - bucket:       True            # {False} plot the bucket
    - pspace:       True            # {False} plot the twiss ellipses at entrance
    # - verbose:      2               # {0} print flag (0 = minimal print), try 0,1,2,3
#...........................................................................................
## SECTION definitions
SECTIONS:
     - [&LE 5to25 , &HE 25to200]
#...........................................................................................
## INPUT definitions
PARAMETERS:
    - Tkin:                 _TKIN       # [MeV] energy @ injection
    - DT2T:                 _DT2T       # delta-T/T kinetic energy spread @ injection
    - emitx_i:      &emx    _EMITX      # [m*rad] {x,x'} emittance @ entrance
    - emity_i:      &emy    _EMITY      # [m*rad] {y,y'} emittance @ entrance
    - betax_i:      &btx    _BETAX      # [m] twiss beta @ entrance x
    - betay_i:      &bty    _BETAY      # [m] twiss beta @ entrance y
    - phi_sync:     &phs    _PHISY      # [deg] synchronous phase
    # - alfax_i:              0.0         # [] twiss alpha x @ entrance
    # - alfay_i:              -0.0        # [] twiss alpha y @ entrance
    - alfax_i:              0.9         # [] twiss alpha x @ entrance
    - alfay_i:              -0.9        # [] twiss alpha y @ entrance
    - frequency:    &freq   _FREQ       # [Hz] frequency
    - ql0:          &p02    0.04        # [m] quad-length
    - ql:           &p03    0.02        # [m] 1/2 quad-length
    - quad_bore:    &p04    0.011       # [m] quad bore radius
    - windings:             30          # [] quad-coil windings
    - gap:          &p15    0.046       # [m] RF gap
    - nbsigma:              3           # [m] sigma aperture
    - aperture:             15.e-3      # [m] global aperture setting (default = None)
    - lattvers:    29.01.19_pyO         # lattice version
    - mapping:              _MAPPING    # [t3d, simple, oxal, base, ttf, dyn]
#...........................................................................................
## ELEMENTS definitions
ELEMENTS:
# HE
    - D3:                        # ID: &alias
        - type:     D            # D class
        - length:   0.03         # [m]
        - sec:      *HE          # is part of section
    - D5:                        # ID: &alias
        - type:     D            # D class
        - length:   0.023        # [m] half cavity
        - sec:      *HE          # is part of section
    - D10:                       # ID: &alias
        - type:     D            # D class
        - length:   0.100        # [m]
        - sec:      *HE          # is part of section
    - QFH:                       # ID: &alias
        - type:     QF           # QF class
        - length:   *p03         # [m]
        - aperture: *p04         # [m] quad bore
        - B':       &Bgrad _BGRAD # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *HE          # is part of section
    - QDH:                       # ID: &alias
        - type:     QD           # QD class
        - length:   *p02         # [m] length
        - aperture: *p04         # [m] quad bore
        - B':       *Bgrad       # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *HE          # is part of section
    - RFGHx:                     # replacement of RFG by D
        - type:     D            # replacement of RFG by D
        - length:   0.0          # replacement of RFG by D
        - sec:      *HE          # replacement of RFG by D
    - RFGH:                      # ID: &alias
        - type:     RFG          # RFG class
        - EzAvg:    1.05         # [MV/m] average E-field on axis
        - EzPeak:   1.40         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        - PhiSync:  *phs         # [deg] synchronous phase
        - freq:     *freq        # [Hz] frequency
        - gap:      *p15         # [m] length
        # - aperture: *p04         # [m] quad bore
        - aperture: 10.e-3       # [m] quad bore
        - SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        - sec:      *HE          # is part of section
    - RFCH:                      # ID: &alias
        - type:     RFC          # RFC class
        - EzAvg:    1.05         # [MV/m] average E-field on axis
        - EzPeak:   1.40         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        - PhiSync:  *phs         # [deg] synchronous phase
        - freq:     *freq        # [Hz] frequency
        - gap:      *p15         # [m] gap length
        # - aperture: *p04         # [m] quad bore
        - aperture: 10.e-3         # [m] quad bore
        - SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        - length:   0.044        # [m] cavity length
        - sec:      *HE          # is part of section
    - SCF:                       # ID: &alias
        - type:    MRK           # MRK class
        - action:
            - poincare           # action aperture check
        - sec:     *HE
#...........................................................................................
# LATTICE definition: NODE->SEGMENT->CELL->LINE->LATTICE
#...........................................................................................
NODES:  # mapping table: NODE: &node ==> ELEMENT
- D1:   &d1   D3
- D2:   &d2   D5
- D3:   &d3   D10
- QF:   &qf   QFH
- QD:   &qd   QDH
- GAP:  &gap  RFGH
- CAV:  &cav  RFCH
#...........................................................................................
SEGMENTS:   # group NODEs in SEGMENT
- SQD:   &sqd  [*d1,*qd,*d1]  # QD + LR drifts
- SQF1:  &sqf1 [*qf,*d1]      # 1/2QF + R drift
- SQF2:  &sqf2 [*d1,*qf]      # 1/2Qf + L drift
# rf-gap + LR drifts
- SRFGAP:  &srfgap
    - [*d2,*gap,*d2]          # gap 1
    - [*d2,*gap,*d2]          # gap 2
    - [*d2,*gap,*d2]          # gap 3
    - [*d2,*gap,*d2]          # gap 4
    - [*d2,*gap,*d2]          # gap 5
    - [*d2,*gap,*d2]          # gap 6
    - [*d2,*gap,*d2]          # gap 7
    - [*d2,*gap,*d2]          # gap 8
    - [*d2,*gap,*d2]          # gap 9
    - [*d2,*gap,*d2]          # gap 10
# pillbox cavities
- SRFCAV: &srfcav
    - [*cav]                  # cav 1
    - [*cav]                  # cav 2
    - [*cav]                  # cav 3
    - [*cav]                  # cav 4
    - [*cav]                  # cav 5
    - [*cav]                  # cav 6
    - [*cav]                  # cav 7
    - [*cav]                  # cav 8
    - [*cav]                  # cav 9
    - [*cav]                  # cav 10
- SRFG: &srfg [*srfgap,*d3,*srfgap]     # gap-array + drift + gap-array
- SRFC: &srfc [*srfcav,*d3,*srfcav]     # cavity-array + drift + cavity-array
#...........................................................................................
CELL: &cell   # concatenate SEGMENTS to one FODO-cell + cavity-arrays
# - [*sqf1,*srfg,*sqd,*srfg,*sqf2]
- [*sqf1,*srfc,*sqd,*srfc,*sqf2]
#...........................................................................................
LINE: &line   # concatenate CELLS to sublattice LINE
- [*cell]
#...........................................................................................
LATTICE:      # concatenate LINES and duplicate result _NL times
- [_NL,*line]

