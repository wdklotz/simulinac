# Copyright 2015 Wolf-Dieter Klotz <wdklotz@gmail.com>
# This file is part of the SIMULINAC code

# SIMULINAC is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.

# SIMULINAC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with SIMULINAC.  If not, see <http://www.gnu.org/licenses/>.

#..........................................................................................
# Input file for FODO linac simulator
# Input file follows YAML syntax (http:\\http://yaml.org/)
#
# Note:
#   Repeated nodes are initially denoted by an ampersand ( & )
#   and thereafter referenced with an asterisk ( * ).
#..........................................................................................
## RUN switches
FLAGS:
    # - accON:        False           # {True} acceleration on/off flag
    # - egf:          True            # {False} emittance growth flag
    # - sigma:        False           # {True} beam sizes by sigma-matrix
    # - KVout:        True            # {False} print a dictionary of Key-Value pairs, no display
    # - periodic:     True            # {False} treat lattice as ring
    # - express:      True            # {False} use express version of thin quads
    # - useaper:      True            # {False} use aperture check for lattice elements
    # - csTrak:       False           # {True} plot CS trajectories
    # - bucket:       True            # {False} plot the bucket
    # - pspace:       True            # {False} plot the twiss ellipses at entrance
    # - verbose:      2               # {0} print flag (0 = minimal print), try 0,1,2,3
#...........................................................................................
## SECTION definitions
SECTIONS:
     - [&LE low_energy , &HE high_energy]
#...........................................................................................
## INPUT definitions
PARAMETERS:
    - Tkin:                 6.         # [MeV] energy @ injection
    # - Tkin:                 13.         # [MeV] energy @ injection
    - DT2T:                 1.e-3      # delta-T/T kinetic energy spread @ injection
    - emitx_i:      &emx    1.e-6      # [m*rad] {x,x'} emittance @ entrance
    - emity_i:      &emy    1.e-6      # [m*rad] {y,y'} emittance @ entrance
    - betax_i:      &btx    3.3        # [m] twiss beta @ entrance x
    - betay_i:      &bty    0.55       # [m] twiss beta @ entrance y
    - phi_sync:     &phs    -25.       # [deg] synchronous phase
    - frequency:    &freq   816.e+6    # [Hz] frequency
    - alfax_i:              0.0        # [] twiss alpha x @ entrance
    - alfay_i:              0.0        # [] twiss alpha y @ entrance
    - ql0:          &p02    0.04       # [m] quad-length
    - ql:           &p03    0.02       # [m] 1/2 quad-length
    - quad_bore:    &p04    0.011      # [m] quad bore radius
    - windings:             30         # [] quad-coil windings
    - gap:          &p15    0.046      # [m] RF gap
    - EzPeak:       &p17    1.4        # [MV/m] peak gap field Strengy
    - nbsigma:              2          # [m] sigma aperture
    - aperture:             15.e-3     # [m] global aperture setting (default = None)
    - lattvers:            25.10.21_SH # lattice version
    - mapping:              t3d       # [t3d, simple, oxal, base, ttf, dyn]
    # - mapping:   t3d         # Trace 3D linear map model
    # - mapping:   simple      # Shishlo/Holmes linear map model
    # - mapping:   oxal        # Shishlo/Holmes openXAL gap-model
    # - mapping:   base        # Shishlo/Holmes base map model
    # - mapping:   ttf         # Shishlo/Holmes three point TTF RF gap-model
    # - mapping:   dyn         # Tanke/Valero RF gap-model
#...........................................................................................
## ELEMENTS definitions
ELEMENTS:
# LE
    - D3L:                   # ID: &alias
        - type:     D            # D class
        - length:   0.03         # [m]
        - sec:      *LE          # is part of section
    - D10L:                 # ID: &alias
        - type:     D            # D class
        - length:   0.100        # [m]
        - sec:      *LE          # is part of section
    - QFL:                   # ID: &alias
        - type:     QF           # QF class
        - length:   .04          # [m]
        - aperture: .011         # [m] quad bore
        - B':       12.0         # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *LE          # is part of section
    - QDL:                   # ID: &alias
        - type:     QD           # QD class
        - length:   .08          # [m] length
        - aperture: .011         # [m] quad bore
        - B':       12.0         # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *LE          # is part of section
    - RFCL:                 # ID: &alias
        - type:     RFC          # RFC class
        - EzAvg:    1.00         # [MV/m] average E-field on axis
        - EzPeak:   1.40         # [MV/m] # corresdponds to (EzAvg = 1.00[MV/m])
        - PhiSync:  -30.         # [deg] synchronous phase
        - freq:      *freq        # [Hz] frequency
        - gap:      0.026        # [m] gap length
        - aperture: 10.e-3       
        - SFdata:   SF_WDK2g22.TBL # superfish tbl-data file
        - length:   0.026        # [m] cavity length
        - sec:      *LE          # is part of section
# HE
    - D3:                     # ID: &alias
        - type:     D            # D class
        - length:   0.03         # [m]
        - sec:      *HE          # is part of section
    - D10:                   # ID: &alias
        - type:     D            # D class
        - length:   0.100        # [m]
        - sec:      *HE          # is part of section
    - QFH:                   # ID: &alias
        - type:     QF           # QF class
        - length:   0.02         # [m]
        - aperture: 0.011        # [m] quad bore
        - B':       &Bgrad 20.   # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *HE          # is part of section
    - QDH:                   # ID: &alias
        - type:     QD           # QD class
        - length:   0.04         # [m] length
        - aperture: 0.011        # [m] quad bore
        - B':       *Bgrad       # [T/m] quadrupole gradient
        - slices:   0            # if slices == 0|1: one thick element else: many thin elements
        - sec:      *HE          # is part of section
    - RFGHx:               # replacement of RFG by D
        - type:     D            # replacement of RFG by D
        - length:   0.0          # replacement of RFG by D
        - sec:      *HE          # replacement of RFG by D
    - RFGH:                # ID: &alias
        - type:     RFG          # RFG class
        - EzAvg:    1.00         # [MV/m] average E-field on axis
        - EzPeak:   *p17         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        - PhiSync:  *phs         # [deg] synchronous phase
        - freq:     *freq        # [Hz] frequency
        - gap:      *p15         # [m] length
        - aperture: 10.e-3       # [m] quad bore
        - SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        - sec:      *HE          # is part of section
    - RFCH:                 # ID: &alias
        - type:     RFC          # RFC class
        - EzAvg:    1.00         # [MV/m] average E-field on axis
        - EzPeak:   *p17         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        - PhiSync:  *phs         # [deg] synchronous phase
        - freq:     *freq        # [Hz] frequency
        - gap:      *p15         # [m] gap length
        - aperture: 10.e-3       # [m] quad bore
        - SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        - length:   *p15         # [m] cavity length
        - sec:      *HE          # is part of section
    - SCF:                   # ID: &alias
        - type:    MRK           # MRK class
        - action:  poincare      #  phase space poincare maps
        # - prefix:  frames       # path to store frames
        - sec:     *LE            # is part of section
#...........................................................................................
# LATTICE definition: NODE->SEGMENT->CELL->LINE->LATTICE
#...........................................................................................
NODES:  # mapping table: NODE: &node ==> ELEMENT
- F_Quad:     &QFL QFL
- F_Quad:     &QFH QFH
- D_Quad:     &QDL QDL
- D_Quad:     &QDH QDH
- Drift:      &D3L D3L
- Drift:      &D3 D3
- Drift:      &D10L D10L
- Drift:      &D10H D10L
- RF_Cavity:  &CAV  RFCL
- RF_Cavity:  &CAVH  RFCH
- Foil:       &FOIL SCF
#...........................................................................................
SEGMENTS:
# low energy section
- QF+D:    &seg1L  [*QFL,*D3L] 
- D+QD+D:  &seg2L  [*D3L,*QDL,*D3L] 
- D+QF:    &seg3L  [*D3L,*QFL]      
# pillbox cavities
- RF_Cavity_Array:  &rfcavl
    - [*CAV]          # 1
    - [*CAV]          # 2
    - [*CAV]          # 3
    - [*CAV]          # 4
    - [*CAV]          # 5
    - [*CAV]          # 6
    - [*CAV]          # 7
    - [*CAV]          # 8
    - [*CAV]          # 9
    - [*CAV]          # 10
    - [*CAV]          # 11
    - [*CAV]          # 12
    - [*D10L]         # 10cm drift
    - [*CAV]          # 1
    - [*CAV]          # 2
    - [*CAV]          # 3
    - [*CAV]          # 4
    - [*CAV]          # 5
    - [*CAV]          # 6
    - [*CAV]          # 7
    - [*CAV]          # 8
    - [*CAV]          # 9
    - [*CAV]          # 10
    - [*CAV]          # 11
    - [*CAV]          # 12
- Cacvity_Block: &cav_L_block [*rfcavl]

# high energy section
- QF+D:    &seg1H  [*QFH,*D3] 
- D+QD+D:  &seg2H  [*D3,*QDH,*D3] 
- D+QF:    &seg3H  [*D3,*QFH] 
# pillbox cavities
- RF_Cavity_Array:     &rfcavh       
    - [*CAVH]         # 1 
    - [*CAVH]         # 2 
    - [*CAVH]         # 3 
    - [*CAVH]         # 4 
    - [*CAVH]         # 5 
    - [*CAVH]         # 6 
    - [*CAVH]         # 7 
    - [*CAVH]         # 8 
    - [*CAVH]         # 9 
    - [*CAVH]         # 10 
    - [*D10H]         # 10cm drift
    - [*CAVH]         # 1 
    - [*CAVH]         # 2 
    - [*CAVH]         # 3 
    - [*CAVH]         # 4 
    - [*CAVH]         # 5 
    - [*CAVH]         # 6 
    - [*CAVH]         # 7 
    - [*CAVH]         # 8 
    - [*CAVH]         # 9 
    - [*CAVH]         # 10 
- Cacvity_Block: &cav_H_block [*rfcavh]
#...........................................................................................
CELL: &cell_low
- [*seg1L,*cav_L_block,*seg2L,*cav_L_block,*seg3L]
CELL: &cell_high
- [*seg1H,*cav_H_block,*seg2H,*cav_H_block,*seg3H]
#...........................................................................................
LINE: &line_low   # concatenate CELLS to sublattice LINE
- [*cell_low]       # 1
- [*cell_low]       # 
- [*cell_low]       # 
- [*cell_low]       # 
- [*cell_low]       # 5
- [*cell_low]       # 
- [*cell_low]       # 
- [*cell_low]       # 
- [*cell_low]       # 
- [*cell_low]       # 10
LINE: &line_high
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#10
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#20
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#30
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#40
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#50
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#60
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#70
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#80
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#90
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#100
- [*cell_high]      # 1
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 5
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      #
- [*cell_high]      # 10
#110
#...........................................................................................
LATTICE:      # concatenate LINES and duplicate result _NL times
- [1,*line_low]
- [*line_high]
- [*line_high]
- [*FOIL]

