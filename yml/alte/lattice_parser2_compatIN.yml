# Copyright 2015 Wolf-Dieter Klotz <wdklotz@gmail.com>
# This file is part of the SIMULINAC code

# SIMULINAC is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.

# SIMULINAC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with SIMULINAC.  If not, see <http://www.gnu.org/licenses/>.

#..........................................................................................
# Input file for FODO linac simulator
# Input file follows YAML syntax (http:\\http://yaml.org/)
#
# Note:
#   Repeated nodes are initially denoted by an ampersand ( & )
#   and thereafter referenced with an asterisk ( * ).

#..........................................................................................
## RUN switches
#..........................................................................................
FLAGS:
    # accON:        False           # {True} accSeleration on/off flag
    # egf:          True            # {False} emittance growth flag
    sigma:        False           # {True} beam sizes by sigma-matrix
    # KVout:        True            # {False} print a dictionary of Key-Value pairs, no display
    # periodic:     True            # {False} treat lattice as ring
    # express:      True            # {False} use express version of thin quads
    # useaper:      True            # {False} use aperture check for lattice elements
    # csTrak:       False           # {True} plot CS trajectories
    # bucket:       True            # {False} plot the bucket
    # pspace:       True            # {False} plot the twiss ellipses at entrance
    # verbose:      2               # {0} print flag (0 = minimal print), try 0,1,2,3
#...........................................................................................
## INPUT definitions
#...........................................................................................
PARAMETERS:
    Tkin:                 6.          # [MeV] energy @ injection
    DT2T:                 1.0e-3      # delta-T/T kinetic energy spread @ injection
    emitx_i:      &emx    1.e-6       # [m*rad] {x,x'} emittance @ entrance
    emity_i:      &emy    1.e-6       # [m*rad] {y,y'} emittance @ entrance
    betax_i:      &btx    3.3         # [m] twiss beta @ entrance x
    betay_i:      &bty    0.55        # [m] twiss beta @ entrance y
    phi_sync:     &phs    -25.        # [deg] synchronous phase
    frequency:    &freq   816.e6      # [Hz] frequency
    alfax_i:              0.0         # [] twiss alpha x @ entrance
    alfay_i:              -0.0        # [] twiss alpha y @ entrance
    ql0:          &p02    0.04        # [m] quad-length
    ql:           &p03    0.02        # [m] 1/2 quad-length
    quad_bore:    &p04    0.011       # [m] quad bore radius
    windings:             30          # [] quad-coil windings
    gap:          &p15    0.046       # [m] RF gap
    EzPeak:       &p17    1.4         # [MV/m] peak gap field Strengy
    nbsigma:              2           # [m] sigma aperture
    aperture:             15.e-3      # [m] global aperture setting (default = None)
    lattvers:             25.10.21_SH # lattice version
    mapping:      &map    t3d         # [t3d, simple, oxal, base, ttf, dyn]
#...........................................................................................
## ELEMENTS (a.k.a. NOdes) definitions
#...........................................................................................
ELEMENTS:
# Nodes in low energy section
    D3L:                       # ID: &alias
        type:     D            # D class
        length:   0.03         # [m]
        sec:      LE           # section 
    Dip5:                        # ID: &alias
        type:     D            # D class
        length:   0.023        # [m] half cavity
        sec:      LE           # section 
    D10L:                      # ID: &alias
        type:     D            # D class
        length:   0.100        # [m]
        sec:      LE           # section 
    QFL:                       # ID: &alias
        type:     QF           # QF class
        length:   .04          # [m]
        aperture: .011         # [m] quad bore
        B':       12.0         # [T/m] quadrupole gradient
        slices:   0            # if slices == 0|1: one thick element else: many thin elements
        sec:      LE           # section 
    QDL:                       # ID: &alias
        type:     QD           # QD class
        length:   0.08         # [m] length
        aperture: 0.011        # [m] quad bore
        B':       12.0         # [T/m] quadrupole gradient
        slices:   0            # if slices == 0|1: one thick element else: many thin elements
        sec:      LE           # section 
    RFCL:                      # ID: &alias
        type:     RFC          # RFC class
        EzAvg:    1.00         # [MV/m] average E-field on axis
        EzPeak:   1.40         # [MV/m] # corresdponds to (EzAvg = 1.00[MV/m])
        PhiSync:  -30.         # [deg] synchronous phase
        freq:      *freq       # [Hz] frequency
        gap:      0.026        # [m] gap length
        aperture: 10.e-3       
        SFdata:   SF_WDK2g22.TBL # superfish tbl-data file
        mapping:  *map         # mapping in cavities
        length:   0.026        # [m] cavity length
        sec:      LE           # section 
# Nodes in high energy section
    D3H:                       # ID: &alias
        type:     D            # D class
        length:   0.03         # [m]
        sec:      HE           # section 
    D10H:                      # ID: &alias
        type:     D            # D class
        length:   0.100        # [m]
        sec:      HE           # section 
    QFH:                       # ID: &alias
        type:     QF           # QF class
        length:   0.02         # [m]
        aperture: 0.011        # [m] quad bore
        B':       &Bgrad 20.   # [T/m] quadrupole gradient
        slices:   0            # if slices == 0|1: one thick element else: many thin elements
        sec:      HE           # section 
    QDH:                       # ID: &alias
        type:     QD           # QD class
        length:   0.04         # [m] length
        aperture: 0.011        # [m] quad bore
        B':       *Bgrad       # [T/m] quadrupole gradient
        slices:   0            # if slices == 0|1: one thick element else: many thin elements
        sec:      HE           # section 
    RFGHx:                     # replacement of RFG by D
        type:     D            # replacement of RFG by D
        length:   0.0          # replacement of RFG by D
        sec:      HE           # section 
    RFGH:                      # ID: &alias
        type:     RFG          # RFG class
        # EzAvg:    1.00         # [MV/m] average E-field on axis
        EzPeak:   *p17         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        PhiSync:  *phs         # [deg] synchronous phase
        freq:     *freq        # [Hz] frequency
        gap:      *p15         # [m] length
        aperture: 10.e-3       # [m] quad bore
        SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        sec:      HE           # section 
    RFCH:                      # ID: &alias
        type:     RFC          # RFC class
        # EzAvg:    2.00         # [MV/m] average E-field on axis
        EzPeak:    2.0         # [MV/m] # corresdponds to (EzAvg = 1.05[MV/m])
        PhiSync:  -10.         # [deg] synchronous phase
        freq:     *freq        # [Hz] frequency
        gap:      *p15         # [m] gap length
        aperture: 10.e-3       # [m] quad bore
        SFdata:   SF_WDK2g44.TBL # superfish tbl-data file
        mapping:  base         # mapping in cavities
        length:   *p15         # [m] cavity length
        sec:      HE           # section 
    # PsMkr:                     # ID
    #     type:     MRK          # MRK class
    #     action:   pspace       # phase space marker actions
    #     which:    no_plot      #  {transvers} phase space ellipses
    #     sec:                   # section 
    # SCF:                     # ID: &alias
    #     type:    MRK         # MRK class
    #     action:  poincare    #  phase space poincare maps
        # - prefix:  frames    # path to store frames
# ...........................................................................................
# LATTICE definition starts here:  
         # Node is part of Segment is part of Cell is part of Section is part of LINE
# ...........................................................................................
SEGMENTS:   # group ELEMENTs into SEGMENTs:
            # Syntax: [number[node,...,node]]
            # list [node,...,node] is repeated number times
#...........................................................................................
# Marker segment
    # Psmarker:              [1,[PsMkr]]
# LE section segment
    QF+D-L:                [1,[QFL, D3L]]
    D+QD+D-L:              [1,[D3L, QDL, D3L]]
    D+QF-L:                [1,[D3L, QFL]]
# pillbox cavities
    CavitiesL:             [12,[RFCL]]
    RF_Cavity_ArrayL:      [1,[CavitiesL, D10L, CavitiesL]]
# HE section segments
    QF+D-H:                 [1,[QFH, D3H]]
    D+QD+D-H:               [1,[D3H, QDH, D3H]]
    D+QF-H:                 [1,[D3H, QFH]]
# pillbox cavities
    CavitiesH:              [10,[RFCH]]
    RF_Cavity_ArrayH:       [1,[CavitiesH, D10H, CavitiesH]]
#...........................................................................................
CELLS:    # group SEGMENTS into CELLs: order given by [...] syntax
#...........................................................................................
    CELL-L:   [1,[QF+D-L, RF_Cavity_ArrayL, D+QD+D-L, RF_Cavity_ArrayL, D+QF-L]] 
    CELL-H:   [1,[QF+D-H, RF_Cavity_ArrayH, D+QD+D-H, RF_Cavity_ArrayH, D+QF-H]]  
#...........................................................................................
SECTIONS:   # group CELLs into SECTIONS
#...........................................................................................
  S-LE:      [2,[CELL-L]]
  S-HE:      [2,[CELL-H]]
  S-DUMMY:   [1,[CELL-H]]
#........................................................................................... 
LATTICE:    # group SECTIONs into a LATTICE: here the LATTICE is one single LINE 
            # with 2 Secions and 1 Marker in between and Markers at the entrance and the 
            # end.
#........................................................................................... 
#   LINE:   [1,[Psmarker, S-LE, PsMkr, S-HE, Psmarker]]
  LINE:   [1,[S-LE, S-HE]]
  